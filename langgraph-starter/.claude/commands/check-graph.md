# /check-graph - LangGraph é…ç½®éªŒè¯å‘½ä»¤

## å‘½ä»¤æè¿°

`/check-graph` å‘½ä»¤ç”¨äºéªŒè¯ LangGraph å›¾é…ç½®çš„æ­£ç¡®æ€§ï¼Œæ£€æŸ¥çŠ¶æ€å®šä¹‰ã€èŠ‚ç‚¹å‡½æ•°ã€è¾¹è¿æ¥ã€ç±»å‹æ³¨è§£ç­‰å„ä¸ªæ–¹é¢ã€‚

## ä½¿ç”¨æ–¹æ³•

```
/check-graph <éªŒè¯çº§åˆ«> <æ£€æŸ¥é€‰é¡¹>
```

### éªŒè¯çº§åˆ«
- `quick` - å¿«é€Ÿæ£€æŸ¥ï¼ˆåŸºæœ¬ç»“æ„ï¼‰
- `standard` - æ ‡å‡†æ£€æŸ¥ï¼ˆæ¨èï¼‰
- `thorough` - å½»åº•æ£€æŸ¥ï¼ˆåŒ…æ‹¬æœ€ä½³å®è·µï¼‰
- `strict` - ä¸¥æ ¼æ£€æŸ¥ï¼ˆæ‰€æœ‰è§„åˆ™ï¼‰

### æ£€æŸ¥é€‰é¡¹
- `--state` - éªŒè¯çŠ¶æ€å®šä¹‰
- `--nodes` - éªŒè¯èŠ‚ç‚¹å‡½æ•°
- `--edges` - éªŒè¯è¾¹è¿æ¥
- `--types` - éªŒè¯ç±»å‹æ³¨è§£
- `--best-practices` - æ£€æŸ¥æœ€ä½³å®è·µ
- `--security` - å®‰å…¨æ£€æŸ¥
- `--all` - æ‰€æœ‰æ£€æŸ¥

## æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1: å‘ç°å›¾å®šä¹‰
æ‰«æé¡¹ç›®ä¸­æ‰€æœ‰ LangGraph å›¾å®šä¹‰ï¼š
```
å‘ç°çš„å›¾:
- graphs/react_agent.py
- graphs/multi_agent.py
- graphs/sequential_flow.py
```

### æ­¥éª¤ 2: è§£æç»“æ„
è§£ææ¯ä¸ªå›¾çš„ï¼š
- çŠ¶æ€å®šä¹‰
- èŠ‚ç‚¹åˆ—è¡¨
- è¾¹è¿æ¥
- ç¼–è¯‘é…ç½®

### æ­¥éª¤ 3: æ‰§è¡ŒéªŒè¯
æ ¹æ®éªŒè¯çº§åˆ«æ‰§è¡Œæ£€æŸ¥ï¼š
```
âœ“ çŠ¶æ€å®šä¹‰æœ‰æ•ˆ
âœ“ èŠ‚ç‚¹å‡½æ•°å­˜åœ¨
âœ“ è¾¹è¿æ¥æ­£ç¡®
âš  ç¼ºå°‘ç±»å‹æ³¨è§£
âœ— æœªå¤„ç†çš„å¼‚å¸¸
```

### æ­¥éª¤ 4: ç”ŸæˆæŠ¥å‘Š
ç”Ÿæˆè¯¦ç»†çš„éªŒè¯æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š
- é”™è¯¯åˆ—è¡¨ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
- è­¦å‘Šåˆ—è¡¨ï¼ˆå»ºè®®ä¿®å¤ï¼‰
- ä¼˜åŒ–å»ºè®®ï¼ˆå¯é€‰æ”¹è¿›ï¼‰
- æœ€ä½³å®è·µå»ºè®®

### æ­¥éª¤ 5: ä¿®å¤å»ºè®®
æä¾›å…·ä½“çš„ä¿®å¤ä»£ç ç¤ºä¾‹ã€‚

## éªŒè¯æ£€æŸ¥é¡¹

### 1. çŠ¶æ€å®šä¹‰æ£€æŸ¥

#### å¿…é¡»æ£€æŸ¥
- [ ] çŠ¶æ€ç±»ç»§æ‰¿è‡ª TypedDict
- [ ] æ‰€æœ‰å­—æ®µæœ‰ç±»å‹æ³¨è§£
- [ ] åˆ—è¡¨å­—æ®µä½¿ç”¨ Annotated å®šä¹‰æ›´æ–°é€»è¾‘
- [ ] å­—æ®µåç§°æ‹¼å†™ä¸€è‡´

#### ç¤ºä¾‹éªŒè¯
```python
# âœ… æ­£ç¡®
from typing import Annotated, TypedDict

class GoodState(TypedDict):
    messages: Annotated[list, lambda x, y: x + y]
    query: str

# âŒ é”™è¯¯
class BadState:
    messages: list  # ç¼ºå°‘ TypedDict
    query: str  # ç¼ºå°‘ç±»å‹æ³¨è§£
```

### 2. èŠ‚ç‚¹å‡½æ•°æ£€æŸ¥

#### å¿…é¡»æ£€æŸ¥
- [ ] èŠ‚ç‚¹å‡½æ•°æœ‰ç±»å‹æ³¨è§£
- [ ] å‚æ•°ç±»å‹ä¸çŠ¶æ€åŒ¹é…
- [ ] è¿”å›å€¼æ˜¯å­—å…¸
- [ ] è¿”å›çš„é”®åœ¨çŠ¶æ€ä¸­å­˜åœ¨
- [ ] æ²¡æœ‰ç›´æ¥ä¿®æ”¹è¾“å…¥çŠ¶æ€

#### ç¤ºä¾‹éªŒè¯
```python
# âœ… æ­£ç¡®
def good_node(state: GraphState) -> dict:
    """èŠ‚ç‚¹æè¿°"""
    return {"messages": ["æ–°æ¶ˆæ¯"]}

# âŒ é”™è¯¯
def bad_node(state):
    # ç¼ºå°‘ç±»å‹æ³¨è§£
    state["messages"].append("æ–°æ¶ˆæ¯")  # ç›´æ¥ä¿®æ”¹
    return {}  # è¿”å›ç©ºå­—å…¸
```

### 3. è¾¹è¿æ¥æ£€æŸ¥

#### å¿…é¡»æ£€æŸ¥
- [ ] START è¿æ¥åˆ°è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹
- [ ] æ¯ä¸ªèŠ‚ç‚¹å¯è¾¾ï¼ˆæˆ–æ˜¯æœ‰æ„æ„çš„å­¤ç«‹èŠ‚ç‚¹ï¼‰
- [ ] æ¡ä»¶è¾¹çš„è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²æˆ– END
- [ ] æ¡ä»¶è¾¹çš„ç›®æ ‡èŠ‚ç‚¹å­˜åœ¨
- [ ] æ²¡æœ‰æ— é™å¾ªç¯ï¼ˆé™¤éæœ‰æ„ï¼‰

#### ç¤ºä¾‹éªŒè¯
```python
# âœ… æ­£ç¡®
workflow.add_edge(START, "node_a")
workflow.add_conditional_edges(
    "node_a",
    lambda s: "node_b" if s["condition"] else END
)
workflow.add_edge("node_b", END)

# âŒ é”™è¯¯
workflow.add_conditional_edges(
    "node_a",
    lambda s: "nonexistent"  # èŠ‚ç‚¹ä¸å­˜åœ¨
)
```

### 4. ç±»å‹æ³¨è§£æ£€æŸ¥

#### å¿…é¡»æ£€æŸ¥
- [ ] èŠ‚ç‚¹å‡½æ•°å‚æ•°æœ‰ç±»å‹æ³¨è§£
- [ ] èŠ‚ç‚¹å‡½æ•°è¿”å›å€¼æœ‰ç±»å‹æ³¨è§£
- [ ] å·¥å…·å‡½æ•°å‚æ•°æœ‰ç±»å‹æ³¨è§£
- [ ] çŠ¶æ€å­—æ®µæœ‰æ˜ç¡®çš„ç±»å‹

#### ç¤ºä¾‹éªŒè¯
```python
# âœ… æ­£ç¡®
def process(
    state: GraphState
) -> dict[str, Any]:
    pass

@tool
def my_tool(param: str) -> str:
    """å·¥å…·æè¿°"""
    return param

# âŒ é”™è¯¯
def process(state):  # ç¼ºå°‘ç±»å‹
    pass

def my_tool_bad(param):  # ç¼ºå°‘ç±»å‹
    return param
```

### 5. æœ€ä½³å®è·µæ£€æŸ¥

#### æ¨èæ£€æŸ¥
- [ ] èŠ‚ç‚¹å‡½æ•°æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
- [ ] å·¥å…·å‡½æ•°æœ‰æ¸…æ™°çš„æè¿°
- [ ] ä½¿ç”¨äº† checkpointerï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æœ‰é”™è¯¯å¤„ç†
- [ ] æœ‰é™åˆ¶æ­¥æ•°æœºåˆ¶
- [ ] æ—¥å¿—è®°å½•

#### ç¤ºä¾‹éªŒè¯
```python
# âœ… å¥½çš„å®è·µ
def well_documented_node(state: GraphState) -> dict:
    """
    å¤„ç†ç”¨æˆ·æŸ¥è¯¢çš„èŠ‚ç‚¹ã€‚

    Args:
        state: å½“å‰å›¾çŠ¶æ€

    Returns:
        åŒ…å«æ›´æ–°åæ¶ˆæ¯çš„å­—å…¸
    """
    try:
        result = process_query(state["query"])
        return {"messages": [result]}
    except Exception as e:
        logger.error(f"å¤„ç†å¤±è´¥: {e}")
        return {"messages": [f"é”™è¯¯: {e}"]}

# âŒ éœ€è¦æ”¹è¿›
def node(state):
    result = process(state["query"])
    return {"messages": [result]}
```

### 6. å®‰å…¨æ£€æŸ¥

#### å®‰å…¨æ£€æŸ¥é¡¹
- [ ] API å¯†é’¥ä¸ç¡¬ç¼–ç 
- [ ] å·¥å…·è¾“å…¥å·²éªŒè¯
- [ ] æ²¡æœ‰æ³¨å…¥æ¼æ´
- [ ] æ•æ„Ÿæ•°æ®å·²åŠ å¯†
- [ ] æœ‰è®¿é—®æ§åˆ¶

#### ç¤ºä¾‹éªŒè¯
```python
# âœ… æ­£ç¡®
import os

API_KEY = os.getenv("ANTHROPIC_API_KEY")

@tool
def safe_tool(user_input: str) -> str:
    # éªŒè¯è¾“å…¥
    if not user_input or len(user_input) > 1000:
        return "æ— æ•ˆè¾“å…¥"
    # å¤„ç†é€»è¾‘
    return result

# âŒ é”™è¯¯
API_KEY = "sk-ant-..."  # ç¡¬ç¼–ç 

@tool
def unsafe_tool(user_input: str) -> str:
    # ç›´æ¥æ‰§è¡Œç”¨æˆ·è¾“å…¥
    return eval(user_input)  # æ³¨å…¥é£é™©
```

## ç¤ºä¾‹æ‰§è¡Œ

### ç¤ºä¾‹ 1: å¿«é€Ÿæ£€æŸ¥

```bash
/check-graph quick --state --nodes
```

**è¾“å‡º:**
```
æ­£åœ¨éªŒè¯å›¾å®šä¹‰...

å‘ç° 3 ä¸ªå›¾:
âœ“ graphs/react_agent.py
âœ“ graphs/multi_agent.py
âœ“ graphs/sequential_flow.py

çŠ¶æ€å®šä¹‰æ£€æŸ¥:
âœ“ react_agent.AgentState - æ‰€æœ‰å­—æ®µæœ‰ç±»å‹æ³¨è§£
âœ“ multi_agent.TeamState - æ­£ç¡®ä½¿ç”¨ Annotated
âš  sequential_flow.SimpleState - å»ºè®®æ·»åŠ  messages å­—æ®µçš„ reducer

èŠ‚ç‚¹å‡½æ•°æ£€æŸ¥:
âœ“ react_agent.call_model - ç±»å‹æ³¨è§£å®Œæ•´
âœ“ multi_agent.researcher - æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
âš  sequential_flow.process - ç¼ºå°‘è¿”å›å€¼ç±»å‹æ³¨è§£

å¿«é€Ÿæ£€æŸ¥å®Œæˆ:
- é€šè¿‡: 5
- è­¦å‘Š: 2
- é”™è¯¯: 0
```

### ç¤ºä¾‹ 2: æ ‡å‡†æ£€æŸ¥

```bash
/check-graph standard --all
```

**è¾“å‡º:**
```
æ­£åœ¨æ‰§è¡Œæ ‡å‡†æ£€æŸ¥...

æ£€æŸ¥é¡¹ç›®:
[1/6] çŠ¶æ€å®šä¹‰.................. âœ“
[2/6] èŠ‚ç‚¹å‡½æ•°.................. âœ“
[3/6] è¾¹è¿æ¥.................. âš 
[4/6] ç±»å‹æ³¨è§£.................. âœ“
[5/6] æœ€ä½³å®è·µ.................. âš 
[6/6] å®‰å…¨æ£€æŸ¥.................. âœ“

å‘ç°çš„é—®é¢˜:

é”™è¯¯ (å¿…é¡»ä¿®å¤):
âœ— graphs/multi_agent.py:45 - æ¡ä»¶è¾¹è¿”å›äº†éå­—ç¬¦ä¸²å€¼
  def route(state):
      return state["status"]  # åº”è¯¥è¿”å›å­—ç¬¦ä¸²æˆ– END

è­¦å‘Š (å»ºè®®ä¿®å¤):
âš  graphs/react_agent.py:78 - ç¼ºå°‘é”™è¯¯å¤„ç†
  å»ºè®®æ·»åŠ  try-except å—

âš  graphs/sequential_flow.py:23 - ç¼ºå°‘æ­¥æ•°é™åˆ¶
  å»ºè®®æ·»åŠ  max_steps æ£€æŸ¥

ä¼˜åŒ–å»ºè®®:
ğŸ’¡ è€ƒè™‘ä¸ºèŠ‚ç‚¹å‡½æ•°æ·»åŠ æ›´è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
ğŸ’¡ å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨ API å¯†é’¥
ğŸ’¡ å¯ä»¥æ·»åŠ æµå¼è¾“å‡ºä»¥æ”¹å–„ç”¨æˆ·ä½“éªŒ

ä¿®å¤å»ºè®®:

1. ä¿®å¤æ¡ä»¶è¾¹è¿”å›å€¼:
   def route(state: TeamState) -> Literal["continue", END]:
       if state["status"] == "done":
           return END
       return "continue"

2. æ·»åŠ é”™è¯¯å¤„ç†:
   try:
       response = model.invoke(messages)
       return {"messages": [response]}
   except Exception as e:
       logger.error(f"è°ƒç”¨å¤±è´¥: {e}")
       return {"messages": [f"é”™è¯¯: {e}"]}

3. æ·»åŠ æ­¥æ•°é™åˆ¶:
   if state["step_count"] >= MAX_STEPS:
       return {"status": "completed"}

æ£€æŸ¥å®Œæˆ:
- é€šè¿‡: 12
- è­¦å‘Š: 3
- é”™è¯¯: 1
```

### ç¤ºä¾‹ 3: ä¸¥æ ¼æ£€æŸ¥

```bash
/check-graph strict --all
```

**è¾“å‡º:**
```
æ­£åœ¨æ‰§è¡Œä¸¥æ ¼æ£€æŸ¥...

æ­£åœ¨æ£€æŸ¥æ‰€æœ‰è§„åˆ™...

ä¸¥é‡é”™è¯¯ (é˜»å¡å‘å¸ƒ):
âœ— graphs/react_agent.py - ç¼ºå°‘ç±»å‹å¯¼å…¥
  éœ€è¦: from typing import Annotated, TypedDict

âœ— graphs/multi_agent.py - æœªå¤„ç†çš„å¼‚å¸¸è·¯å¾„
  åœ¨ critic èŠ‚ç‚¹ä¸­ï¼Œç¼ºå°‘å¯¹æ¨¡å‹è°ƒç”¨å¤±è´¥çš„å¤„ç†

å¿…é¡»ä¿®å¤:
âœ— graphs/sequential_flow.py - çŠ¶æ€å­—æ®µæœªåœ¨è¿”å›å€¼ä¸­
  èŠ‚ç‚¹ 'process' è¿”å›äº† 'result' å­—æ®µï¼Œä½†çŠ¶æ€ä¸­æœªå®šä¹‰

å¼ºçƒˆå»ºè®®:
âš  æ‰€æœ‰å›¾ - ç¼ºå°‘æ—¥å¿—è®°å½•
  å»ºè®®æ·»åŠ  logging æ¨¡å—

âš  graphs/react_agent.py - ç¡¬ç¼–ç æ¨¡å‹åç§°
  å»ºè®®ä½¿ç”¨é…ç½®æ–‡ä»¶

æœ€ä½³å®è·µ:
ğŸ’¡ å»ºè®®æ·»åŠ å•å…ƒæµ‹è¯•
ğŸ’¡ å»ºè®®æ·»åŠ æ€§èƒ½ç›‘æ§
ğŸ’¡ å»ºè®®æ·»åŠ æ–‡æ¡£

ä¸¥æ ¼æ£€æŸ¥å®Œæˆ:
- ä¸¥é‡é”™è¯¯: 2
- å¿…é¡»ä¿®å¤: 1
- å¼ºçƒˆå»ºè®®: 2
- æœ€ä½³å®è·µ: 3
```

## è‡ªåŠ¨ä¿®å¤

å¯¹äºæŸäº›å¸¸è§é—®é¢˜ï¼Œå‘½ä»¤å¯ä»¥è‡ªåŠ¨ä¿®å¤ï¼š

```bash
/check-graph standard --auto-fix
```

**è‡ªåŠ¨ä¿®å¤é¡¹:**
- æ·»åŠ ç¼ºå¤±çš„ç±»å‹å¯¼å…¥
- æ·»åŠ åŸºæœ¬çš„é”™è¯¯å¤„ç†æ¨¡æ¿
- ç”Ÿæˆæ–‡æ¡£å­—ç¬¦ä¸²æ¨¡æ¿
- ç”Ÿæˆæµ‹è¯•æ–‡ä»¶æ¨¡æ¿

## æŒç»­é›†æˆ

åœ¨ CI ä¸­é›†æˆæ£€æŸ¥ï¼š

```yaml
# .github/workflows/check-graph.yml
name: Check LangGraph

on: [push, pull_request]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          pip install langgraph langchain-core
      - name: Check graphs
        run: |
          # åœ¨ CI ä¸­è¿è¡Œæ£€æŸ¥
          python -m claude check-graph strict --all
```

## æ£€æŸ¥é…ç½®

åˆ›å»º `.claude/check-graph.yml` è‡ªå®šä¹‰æ£€æŸ¥ï¼š

```yaml
# æ£€æŸ¥é…ç½®
check_level: standard

# å¿½ç•¥çš„æ£€æŸ¥é¡¹
ignore:
  - MissingDocstring  # å¿½ç•¥æ–‡æ¡£å­—ç¬¦ä¸²æ£€æŸ¥

# è‡ªå®šä¹‰è§„åˆ™
rules:
  - name: MaxNodes
    enabled: true
    config:
      max: 10  # æœ€å¤š 10 ä¸ªèŠ‚ç‚¹

  - name: CheckContext
    enabled: true
    config:
      require_context: true

# è‡ªå®šä¹‰ä¿®å¤å™¨
fixers:
  - AddTypeError
  - AddMissingImport
```

## æ³¨æ„äº‹é¡¹

### æ£€æŸ¥é¢‘ç‡
- å¼€å‘æ—¶ä½¿ç”¨ `quick` å¿«é€Ÿåé¦ˆ
- æäº¤å‰ä½¿ç”¨ `standard` å…¨é¢æ£€æŸ¥
- å‘å¸ƒå‰ä½¿ç”¨ `strict` ä¸¥æ ¼éªŒè¯

### é”™è¯¯ä¼˜å…ˆçº§
1. **ä¸¥é‡é”™è¯¯**: é˜»å¡è¿è¡Œï¼Œå¿…é¡»ç«‹å³ä¿®å¤
2. **é”™è¯¯**: å½±å“åŠŸèƒ½ï¼Œåº”è¯¥å°½å¿«ä¿®å¤
3. **è­¦å‘Š**: ä¸å½±å“è¿è¡Œï¼Œå»ºè®®ä¿®å¤
4. **å»ºè®®**: ä¼˜åŒ–æœºä¼šï¼Œå¯é€‰

### æ€§èƒ½è€ƒè™‘
- å¤§å‹é¡¹ç›®å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
- å¯ä»¥åªæ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶
- ä½¿ç”¨ç¼“å­˜åŠ é€Ÿé‡å¤æ£€æŸ¥

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ£€æŸ¥è¶…æ—¶
**è§£å†³:** ä½¿ç”¨ `quick` çº§åˆ«æˆ–åªæ£€æŸ¥ç‰¹å®šé¡¹ç›®

### é—®é¢˜ 2: è¯¯æŠ¥
**è§£å†³:** åœ¨é…ç½®ä¸­å¿½ç•¥ç‰¹å®šè§„åˆ™

### é—®é¢˜ 3: æ— æ³•è§£æå›¾
**è§£å†³:** ç¡®ä¿å›¾æ–‡ä»¶è¯­æ³•æ­£ç¡®

## ç›¸å…³å‘½ä»¤

- `/graph` - åˆ›å»ºå›¾åç«‹å³æ£€æŸ¥
- `/agent` - åˆ›å»ºæ™ºèƒ½ä½“åæ£€æŸ¥
- `/state` - å®šä¹‰çŠ¶æ€åéªŒè¯

## ç›¸å…³èµ„æº

- [LangGraph éªŒè¯](https://langchain-ai.github.io/langgraph/concepts/)
- [Python ç±»å‹æ³¨è§£](https://docs.python.org/3/library/typing.html)
- [ä»£ç è´¨é‡å·¥å…·](https://pylint.org/)
