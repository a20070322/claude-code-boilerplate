# RuoYi-Plus 示例重构说明

> 基于 Agent Skills 官方标准 (https://code.claude.com/docs/zh-CN/skills) 重构

## 重构目标

将原有的 Skills 结构升级为符合官方标准的完整结构，充分利用**三级加载机制**。

## 官方标准结构

```
skill-name/
├── SKILL.md           # 主要说明（必需）- 第 2 级加载
├── template.md        # Claude 要填写的模板（新增）
├── examples/
│   └── sample.md      # 显示预期格式的示例输出（新增）
└── scripts/
    └── validate.sh    # Claude 可以执行的脚本（新增）
```

## 三级加载机制

### 第 1 级：元数据（始终加载）
- **内容**: YAML 前置元数据中的 `name` 和 `description`
- **加载时机**: Claude 启动时
- **Token 成本**: 每个 Skill 约 100 tokens
- **作用**: 让 Claude 知道 Skill 的存在和何时使用

### 第 2 级：指令（触发时加载）
- **内容**: SKILL.md 主体
- **加载时机**: 当用户请求与 description 匹配时
- **Token 成本**: 不到 5k tokens
- **作用**: 提供工作流程、最佳实践和指导

### 第 3 级：资源和代码（按需加载）
- **内容**: template.md, examples/*.md, scripts/*.sh
- **加载时机**: 仅在 SKILL.md 中引用时
- **Token 成本**: 实际上无限制
- **作用**: 提供详细的模板、示例和工具

## 重构内容

### 1. 添加 YAML 前置元数据

**SKILL.md 顶部添加**:
```markdown
---
name: crud-development
description: Use when developing CRUD features or business modules in Spring Boot + MyBatis-Plus applications.
             Covers Entity, Service, DAO, Controller generation following four-layer architecture.
             Trigger keywords: CRUD, 增删改查, 业务模块, Entity, Service, Controller
---
```

**要点**:
- ✅ `name` 只包含小写字母、数字和连字符
- ✅ `description` 清晰说明功能和触发条件
- ✅ 包含中英文触发关键词

### 2. 创建 template.md

**用途**: 提供结构化的配置模板，让 Claude 填写

**内容**:
- 模块信息（实体名称、表名）
- 字段定义表
- 业务逻辑说明
- 权限配置
- 生成内容清单

**优势**:
- ✅ 规范化信息收集
- ✅ 确保不遗漏重要信息
- ✅ 减少来回确认

### 3. 创建 examples/ 目录

**用途**: 展示真实的、可运行的代码示例

**内容**:
- user-module.md - 完整的用户模块实现
- 包含所有层级的代码
- 包含关键要点说明

**优势**:
- ✅ 提供完整的上下文
- ✅ 展示最佳实践
- ✅ 可直接参考使用

### 4. 创建 scripts/ 目录

**用途**: 提供可执行的验证脚本

**内容**:
- validate-crud.sh - 验证 CRUD 代码规范

**优势**:
- ✅ 自动化验证
- ✅ 确保代码符合规范
- ✅ 快速发现问题

## 重构对比

### 重构前
```
crud-development/
└── SKILL.md    # 所有内容都在一个文件中
```

**问题**:
- ❌ SKILL.md 过长（500+ 行）
- ❌ 所有内容一次性加载（消耗 tokens）
- ❌ 缺少结构化模板
- ❌ 没有验证工具

### 重构后
```
crud-development/
├── SKILL.md           # 核心规范（~200 行）
├── template.md        # 配置模板
├── examples/
│   └── user-module.md # 完整示例
└── scripts/
    └── validate-crud.sh # 验证脚本
```

**优势**:
- ✅ SKILL.md 精简到核心内容
- ✅ 按需加载，节省 tokens
- ✅ 提供完整示例和模板
- ✅ 包含自动化验证工具

## 使用方式

### Claude 如何使用

**用户请求**:
```
开发一个优惠券管理功能
```

**Claude 执行流程**:
1. 匹配到 `crud-development` skill
2. 读取 SKILL.md（第 2 级）
3. 引用 template.md 填写配置
4. 参考 examples/user-module.md 生成代码
5. 运行 validate-crud.sh 验证代码

### 渐进式披露

**启动时**（第 1 级）:
```
系统提示包含:
- crud-development: CRUD开发规范
- api-development: API设计规范
- database-ops: 数据库操作
...
(每个约 100 tokens)
```

**触发时**（第 2 级）:
```
用户: 开发优惠券管理
Claude: 读取 SKILL.md (~5k tokens)
```

**需要时**（第 3 级）:
```
SKILL.md 中有引用:
"完整代码模板请参考: template.md"
"查看真实案例: examples/user-module.md"
Claude: 按需读取这些文件
```

## 下一步计划

### 为所有 skills 添加标准结构

- [ ] api-development
  - [ ] 添加 YAML 前置元数据
  - [ ] 创建 template.md
  - [ ] 创建 examples/rest-api.md
  - [ ] 创建 scripts/validate-api.sh

- [ ] database-ops
  - [ ] 添加 YAML 前置元数据
  - [ ] 创建 template.md
  - [ ] 创建 examples/table-design.md
  - [ ] 创建 scripts/validate-sql.sh

- [ ] code-patterns
  - [ ] 添加 YAML 前置元数据
  - [ ] 创建 template.md
  - [ ] 创建 examples/naming-conventions.md
  - [ ] 创建 scripts/check-style.sh

## 预期效果

### Token 使用优化

**优化前**:
- 启动加载: 4 skills × ~5k tokens = ~20k tokens

**优化后**:
- 启动加载: 4 skills × ~100 tokens = ~400 tokens
- 触发时加载: ~5k tokens（按需）
- 节省: **95%** 的启动 tokens

### 代码质量提升

**优化前**:
- 规范说明不够详细
- 缺少完整示例
- 没有自动化验证

**优化后**:
- 详细的规范说明
- 完整的代码示例
- 自动化验证工具

## 参考资料

- [Agent Skills 官方文档](https://code.claude.com/docs/zh-CN/skills)
- [知乎副本](https://zhuanlan.zhihu.com/p/1995220079990817400)
- [三级加载机制说明](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/overview)

---

**创建日期**: 2025-02-02
**创建者**: Claude Code
**版本**: 1.0
