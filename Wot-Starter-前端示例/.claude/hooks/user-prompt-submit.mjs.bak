/**
 * User Prompt Submit Hook
 * 强制技能评估流程 - 确保 AI 遵循项目规范
 */

export async function userPromptSubmit(context) {
  const { prompt } = context;

  // 如果是斜杠命令，直接放行
  if (prompt.trim().startsWith('/')) {
    return { proceed: true };
  }

  // 检查是否是代码相关任务
  const codeKeywords = [
    '创建', '生成', '写', '实现', '开发', '添加',
    '页面', '组件', 'API', 'Store', '路由', '状态',
    'page', 'component', 'api', 'store', 'router'
  ];

  const isCodeTask = codeKeywords.some(keyword =>
    prompt.toLowerCase().includes(keyword.toLowerCase())
  );

  if (!isCodeTask) {
    return { proceed: true };
  }

  // 返回强制评估指令
  return {
    proceed: false,
    message: `
## 指令:强制技能激活流程(必须执行)

### 步骤 1 - 评估
针对以下每个技能,陈述: [技能名] - 是/否 - [理由]

可用技能列表:
- uni-page-generator (页面生成)
- alova-api-module (API 模块)
- pinia-store-generator (状态管理)
- vue-composable-creator (组合式函数)
- wot-router-usage (路由导航)
- global-feedback (全局反馈)

### 步骤 2 - 激活
如果任何技能为"是" → 立即使用 Skill() 工具激活
如果所有技能为"否" → 说明"不需要技能"并继续

### 步骤 3 - 实现
只有在步骤 2 完成后,才能开始实现。
    `
  };
}
